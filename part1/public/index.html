<!DOCTYPE html>
<html lang="en">
<head>
  <title>My App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./stylesheets/style.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
  <div id="app">
    <div v-if="notification.visible" :class="['notification', notification.type]">
      {{ notification.message }}
    </div>

    <h1>Dog Walking Service</h1>
    <!-- <p>This is a simple Vue.js application.</p> -->
    <img :src="dogImg" alt="">
    <div v-for="request in walkrequests">
      
        <h2>{{ request.dog_name }}</h2>
        <p><strong>Date:</strong> {{ new Date(request.requested_time).toLocaleDateString() }}</p>
        <p><strong>Time:</strong> {{ new Date(request.requested_time).toLocaleTimeString() }}</p>
        <p><strong>Duration:</strong> {{ request.duration_minutes }} minutes</p>
        <p><strong>Location:</strong> {{ request.location }}</p>
        <p><strong>Owner:</strong> {{ request.owner_username }}</p>
    </div>
  </div>

  <script>
    const app = Vue.createApp({
      data() {
        return {
          notification: {
            visible: false,
            message: '',
            type: '' // 'success' or 'error'
          },
          dogImg: '',
          walkrequests: [],
        }
      },
      methods: {
        async getDogImg() {
          try {
            console.log('Fetching dog image...');
            const response = await fetch('https://dog.ceo/api/breeds/image/random');
            const result = await response.json();
            if (!response.ok) {
              throw new Error(result.error || 'Network response was not ok');
            }
            // deal with the result
            this.dogImg = result.message;
            console.log(this.dogImg);
            this.showNotification('Data fetched successfully!', 'success');
            return result.message;
          } catch (error) {
            console.error('Error fetching dog image:', error);
            this.showNotification('Failed to fetch data.', 'error');
          }
        },
        async getWalkrequests() {
          try {
            console.log('Fetching dog to walk...');
            const response = await fetch('/api/walkrequests/open');
            const result = await response.json();
            if (!response.ok) {
              throw new Error(result.error || 'Network response was not ok');
            }
            // deal with the result
            this.walkrequests = result;
            console.log(this.walkrequests);
            this.showNotification('Data fetched successfully!', 'success');
          } catch (error) {
            console.error('Error fetching dog image:', error);
            this.showNotification('Failed to fetch data.', 'error');
          }
        },
        showNotification(msg, type) {
          this.notification.message = msg;
          this.notification.type = type;
          this.notification.visible = true;
          setTimeout(() => {
            this.notification.visible = false;
          }, 5000);
        },
      },
      mounted() {
        this.getWalkrequests();
      }
    });
    app.mount('#app');
  </script>
</body>
</html>